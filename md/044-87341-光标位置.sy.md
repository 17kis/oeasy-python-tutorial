---
show: step
version: 1.0
enable_checker: true
---

# 光标位置

## 回忆上次内容

- 上次讲了三引号的输出
- 三引号中
	- 回车和引号都会被原样输出
	- 只有`\`还是需要从`\\`转义
- 我们接触过的转义序列
	- `\n`
	- `\r` 
	- `\a`
    - `\b` 
    - `\t` 
    - `\v`、`\f` 
	- `\xhh`
	- `\nnn`
	- `\\ `
	- `\" `
    - `\' `

- 还有哪个转义序列我们没研究过吗？🤔

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210224-1614173286539)

- 这个`\e`是干什么的？
- 首先回忆一下什么是转义？

### 转义 Escape

- 转义转义 
	- 转化含义

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210224-1614157679393)

- `\`反斜杠(backslash)加了之后
- 字符就不是原来的意思了
	- 转义么
- 转义转义 
	- 转化含义
- 所以`\`反斜杠这个字符
	- 也叫做转义字符`Escape character`
	- `\b` 这两个字符的序列算是一个转义序列 `Escape sequence`
	- `\` 这个转义字符会让 `\b`转义序列 
		- 转义为 `Backspace` 这个含义
		- `Backspace`退格就是这个序列转化含义之后的含义
	- 这个转化后的含义也对应一个ascii字符
		- 就是 `\b`
		- 键盘上的<kbd>退格</kbd>对应的数值就是`8`
- `\e`是什么意思呢？

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210224-1614173286539)

- 转义之后的的含义竟然是 escape

### 搜索结果

- 来捋一捋🤔

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210224-1614173286539)

- `\`是转义字符
	- 要和后面的字符一起构成转义序列
- `\e`是转义序列
	- 转义的含义是 Escape
- 所谓转义转义 
	- 转化含义
	- 转义序列`\e`对应的字符含义是Escape
	- 再次逃逸出去
	- 能逃去到哪里呢？

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614205272795)

- 这样可以从当前字符串序列中 Escape 出去
  - 后面的内容可就不是纯文本了
- 而是控制序列(Control Sequence)
  - `[10;20H` 控制 输出
	- 只在`第10行第20列位置`进行输出
- 这个标准后来成为 ANSI escape code
- 我们来试试

### 动手实验

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220414-1649943089931)

- 真的可以定位输出
- 从正常的输出流逃逸到了控制序列！！！

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220414-1649943095718)

- 那为什么有控制序列呢？

### 缘起

- 电传打字机输出的颜色
  - 只能通过控制色带
  - 来控制打印颜色的深浅
- 早期的终端
  - 只能通过调节显示器亮度来进行改变
  - 各个终端的制造商都有一些自己的独特的控制字符
  - 这些特殊字符是和机器相关的
  - 彼此并不兼容
- 但只要接受到这些控制字符
  - 终端就可以进行调整
  - 比如在某个横纵坐标位置`[x,y]`输出字符
- 但是毕竟不同终端控制方式不同
  - 可能造成显示状态异常
  - 远程终端输出结果不可控
  - 需要一个关于控制字符的统一标准
- 1964 年 `ISO 646`
  - 在欧洲以`ECMA-6`的形式存在
  - 后来被`ANSI`(`American National Standards Institute`)
	  - 整合为工业标准
	  - 叫做 ANSI X3.64
- 在计算机发展为图形用户界面之后
  - 在各种 `terminal软件` 中实现

### esc 键

- `\e`这个转义序列开始对应一个按键
	- 最开始叫做`ALT MODE`
	- 是用来切换到模式设置的特殊按键

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614263176102)

- Teletype Model 33 终端的键盘
  - 数据通信行业中最受欢迎的终端之一
  - 1963 年推出
  - 注意 shift 和 ctrl 都已经出现
  - Alt Mode 出现在第 1 列
- 当时还没有 `esc` 键

### escape

- 后来这个东西叫做<kbd>esc</kbd>
	- 在左上角

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614263679174)

- 看起来很像安全逃生出口

### escape 跳出

- 现在键盘都有这个按键
	- 一般在左上角
	- 退出当前游戏
	- 跳出菜单一般用这个

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614305987888)

- 上图<kbd>esc</kbd>在
	- 1 的左下
	- Q 的左边
- 可以从当前的纯文字标准输出流里面
	- 逃(escape)出来
	- 进行控制信息的传输

### 键盘的进化过程

- 早年间的一体机
	- 当年最流行的 DEC VT100
- <kbd>esc</kbd>还在<kbd>1</kbd>旁边
	- 当时还没有在最左上的位置

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614307031201)

### 位置的变化

- 玩一些`terminal`上面的游戏的时候也可以退出主游戏
- 一般进行设置、存盘、读档、退出之类的操作
- 知道什么时候退比知道怎么玩更重要😄

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614306783917)

- 功能键在最左边
- 键盘没有统一的标准
	- 更不存在101标准键盘

### 标准键盘

- 这是101 标准键盘
	- 左上角是<kbd>esc</kbd> 标准位置 

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614306875929)

- 后来放在第一行第一列
	- `escape`体现重要性
	- 还要用边距和<kbd>F1</kbd>之类的拉开距离

### 行业标准

- 键盘开始有了行业标准

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614306949603)

- 可以在ascii里面找到这个esc字符么？

### esc

- 在下图中尝试找到esc

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221015-1665830421389)

- 再到ascii应用找到esc
- (11011)<sub>2</sub>
- 可以更直观一点吗？

### ascii

- 找到这个字符

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20221015-1665830497588)

- 这个esc对应的是
	- 0x1b - 16进制
	- 27 - 10进制
- 对应8进制多少呢？

### 1b

- 1b 是(1b)<sub>16</sub>
- 对应着(27)<sub>10</sub>
- 对应着(33)<sub>8</sub>

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220319-1647657358063)

- 上面的分别是
	- 十六进制形态
	- 十进制形态
	- 八进制形态
- 正如下面

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220319-1647657968361)

- 不同的形态都可以
- 通过转义字符来用吗？

### 不同形态

- 不同的转义方式不影响功能

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220319-1647658036940)

### 操作大全

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614214370989)

- CSI 是
	- Control Sequence Introducer
	- 就是esc加[
		- esc就是\033

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220319-1647658418708)

- \033[nA 光标上移 n 行
- \033[nB 光标下移 n 行
- \033[nC 光标右移 n 行
- \033[nD 光标左移 n 行
- \033[y;xH 设置光标位置
- \033[2J 清屏
- \033[K 清除从光标到行尾的内容
- \033[s 保存光标位置
- \033[u 恢复光标位置
- \033[?25l 隐藏光标
- \033[?25h 显示光标
- 我们先试试\033[2J

### 输出字符

```python3
print("\033[2J")
```

- `\033`是转义序列
	- `\33`是`\033`的省略写法
	- `33` 是 8 进制数形态的ord("\e")
	- 也可以写成 16 进制形态`\x1b`
- J 是模式选择
  - 清屏模式
  - 分为四种清屏
    - 0J - 从光标清到屏幕结束
    - 1J - 从光标清到屏幕开头
    - 2J - 整屏幕清
    - 3J - 整屏幕清并选择清空滚动缓存

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614214080785)

### 观察环境


- 终端屏幕默认 80\*24

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220903-1662192269336)


### 设置光标

```python3
print("\33[1;1Hoeasy")
```
- \33[ 是CSI
	- 控制序列前导符
- 1;1 指的是屏幕左上角
  - 这里指的是终端
	- 横向80字符
	- 纵向24字符
  - 1;1 指的是左上角
  - 中间用的是;
  - 设置好了之后输出后面的字符 oeasy
- H 是模式选择

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614214604193)

- 可以先清屏再输出么？

### 清屏并设置光标

```python3
print("\33[2J")
print("\33[1;1Hoeasy")
```

- 这是两句话
	- 完成两件事
		- 2J清屏
		- 1;1H设置输出位置
- 两句话可以合并成一句

```
print("\33[2J\33[1;1Hoeasy")
```


- "\33[2J\33[1;1Hoeasy"
  - \33[2J 终端接收到后清屏
  - \33[1;1H 终端接收到后设置光标
  - 终端输出 oeasy

```
print("\33[2J\33[10;10Hoeasy")
```

- "\33[2J\33[10;10Hoeasy"
  - 先清屏
  - 再在(10,10)坐标输出`oeasy`

## 总结

- 我们了解了一个新的转义模式
	- \33 逃逸控制字符 esc
		- 这个字符让输出退出标准输出流
		- 进行控制信息的设置
			- 可以清屏
			- 也可以设置光标输出的位置
	- 还能做什么呢？

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210225-1614215584015)

- 可以设置字符的颜色吗？？？🤔
- 我们下次再说！👋
